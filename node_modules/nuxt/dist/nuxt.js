module.exports =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 44);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports) {

module.exports = require("lodash");

/***/ },
/* 1 */
/***/ function(module, exports) {

module.exports = require("path");

/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__);
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__);




exports.encodeHtml = function (str) {
  return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
};

exports.getContext = function (req, res) {
  return {
    req: req,
    res: res
  };
};

exports.setAnsiColors = function (ansiHTML) {
  ansiHTML.setColors({
    reset: ['efefef', 'a6004c'],
    darkgrey: '5a012b',
    yellow: 'ffab07',
    green: 'aeefba',
    magenta: 'ff84bf',
    blue: '3505a0',
    cyan: '56eaec',
    red: '4e053a'
  });
};

exports.waitFor = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.mark(function _callee(ms) {
  return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.wrap(function _callee$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          return _context.abrupt('return', new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function (resolve) {
            setTimeout(resolve, ms || 0);
          }));

        case 1:
        case 'end':
          return _context.stop();
      }
    }
  }, _callee, this);
});

exports.urlJoin = function () {
  return [].slice.call(arguments).join('/').replace(/\/+/g, '/');
};

exports.promisifyRouteParams = function (fn) {
  // If routeParams[route] is an array
  if (Array.isArray(fn)) {
    return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a.resolve(fn);
  }
  // If routeParams[route] is a function expecting a callback
  if (fn.length === 1) {
    return new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function (resolve, reject) {
      fn(function (err, routeParams) {
        if (err) {
          reject(err);
        }
        resolve(routeParams);
      });
    });
  }
  var promise = fn();
  if (!(promise instanceof __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a)) {
    promise = __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a.resolve(promise);
  }
  return promise;
};

/***/ },
/* 3 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/core-js/promise");

/***/ },
/* 4 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/regenerator");

/***/ },
/* 5 */
/***/ function(module, exports) {

module.exports = require("co");

/***/ },
/* 6 */
/***/ function(module, exports) {

module.exports = require("fs-extra");

/***/ },
/* 7 */
/***/ function(module, exports) {

module.exports = require("pify");

/***/ },
/* 8 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/core-js/json/stringify");

/***/ },
/* 9 */
/***/ function(module, exports) {

module.exports = require("debug");

/***/ },
/* 10 */
/***/ function(module, exports) {

module.exports = require("webpack");

/***/ },
/* 11 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/helpers/classCallCheck");

/***/ },
/* 12 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/helpers/createClass");

/***/ },
/* 13 */
/***/ function(module, exports, __webpack_require__) {

"use strict";


var vueLoaderConfig = __webpack_require__(27);

var _require = __webpack_require__(0),
    defaults = _require.defaults;

var _require2 = __webpack_require__(1),
    join = _require2.join;

var _require3 = __webpack_require__(2),
    urlJoin = _require3.urlJoin;

/*
|--------------------------------------------------------------------------
| Webpack Shared Config
|
| This is the config which is extended by the server and client
| webpack config files
|--------------------------------------------------------------------------
*/


module.exports = function () {
  var nodeModulesDir = join(__dirname, '..', 'node_modules');
  var config = {
    devtool: 'source-map',
    entry: {
      vendor: ['vue', 'vue-router', 'vue-meta', 'es6-promise', 'es6-object-assign']
    },
    output: {
      publicPath: urlJoin(this.options.router.base, '/_nuxt/')
    },
    performance: {
      hints: this.dev ? false : 'warning'
    },
    resolve: {
      extensions: ['.js', '.json', '.vue'],
      // Disable for now
      alias: {
        '~': join(this.srcDir),
        'static': join(this.srcDir, 'static'), // use in template with <img src="~static/nuxt.png" />
        '~static': join(this.srcDir, 'static'),
        'assets': join(this.srcDir, 'assets'), // use in template with <img src="~static/nuxt.png" />
        '~assets': join(this.srcDir, 'assets'),
        '~plugins': join(this.srcDir, 'plugins'),
        '~store': join(this.srcDir, 'store'),
        '~router': join(this.dir, '.nuxt/router'),
        '~pages': join(this.srcDir, 'pages'),
        '~components': join(this.srcDir, 'components')
      },
      modules: [nodeModulesDir, join(this.dir, 'node_modules')]
    },
    resolveLoader: {
      modules: [nodeModulesDir, join(this.dir, 'node_modules')]
    },
    module: {
      rules: [{
        test: /\.vue$/,
        loader: 'vue-loader',
        query: vueLoaderConfig.call(this)
      }, {
        test: /\.js$/,
        loader: 'babel-loader',
        exclude: /node_modules/,
        query: defaults(this.options.build.babel, {
          plugins: ['transform-async-to-generator', 'transform-runtime'],
          presets: [['es2015', { modules: false }], 'stage-2'],
          cacheDirectory: !!this.dev
        })
      }]
    },
    plugins: this.options.build.plugins
  };
  // Add nuxt build loaders (can be configured in nuxt.config.js)
  config.module.rules = config.module.rules.concat(this.options.build.loaders);
  // Return config
  return config;
};

/***/ },
/* 14 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/core-js/object/assign");

/***/ },
/* 15 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/core-js/object/keys");

/***/ },
/* 16 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/helpers/typeof");

/***/ },
/* 17 */
/***/ function(module, exports) {

module.exports = require("extract-text-webpack-plugin");

/***/ },
/* 18 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof__ = __webpack_require__(16);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_array_from__ = __webpack_require__(30);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_array_from___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_array_from__);







var _marked = [buildFiles, generateRoutesAndFiles].map(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.mark);

var debug = __webpack_require__(9)('nuxt:build');
debug.color = 2; // force green color
var _ = __webpack_require__(0);
var co = __webpack_require__(5);
var chokidar = __webpack_require__(31);
var fs = __webpack_require__(6);
var hash = __webpack_require__(34);
var pify = __webpack_require__(7);
var webpack = __webpack_require__(10);

var _require = __webpack_require__(41),
    createBundleRenderer = _require.createBundleRenderer;

var _require2 = __webpack_require__(1),
    join = _require2.join,
    resolve = _require2.resolve,
    sep = _require2.sep;

var clientWebpackConfig = __webpack_require__(25);
var serverWebpackConfig = __webpack_require__(26);
var remove = pify(fs.remove);
var readFile = pify(fs.readFile);
var writeFile = pify(fs.writeFile);
var mkdirp = pify(fs.mkdirp);
var glob = pify(__webpack_require__(33));
var reqSep = /\//g;
var sysSep = _.escapeRegExp(sep);
var normalize = function normalize(string) {
  return string.replace(reqSep, sysSep);
};
var wp = function wp(p) {
  /* istanbul ignore if */
  if (/^win/.test(process.platform)) {
    p = p.replace(/\\/g, '\\\\');
  }
  return p;
};
var r = function r() {
  var args = __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_array_from___default()(arguments);
  if (_.last(args).indexOf('~') !== -1) {
    return wp(_.last(args));
  }
  args = args.map(normalize);
  return wp(resolve.apply(null, args));
};

var defaults = {
  filenames: {
    css: 'style.css',
    vendor: 'vendor.bundle.js',
    app: 'nuxt.bundle.js'
  },
  vendor: [],
  loaders: [],
  plugins: [],
  babel: {},
  postcss: []
};
var defaultsLoaders = [{
  test: /\.(png|jpe?g|gif|svg)$/,
  loader: 'url-loader',
  query: {
    limit: 1000, // 1KO
    name: 'img/[name].[ext]?[hash]'
  }
}, {
  test: /\.(woff2?|eot|ttf|otf)(\?.*)?$/,
  loader: 'url-loader',
  query: {
    limit: 1000, // 1 KO
    name: 'fonts/[name].[hash:7].[ext]'
  }
}];
var defaultsPostcss = [__webpack_require__(29)({
  browsers: ['last 3 versions']
})];

exports.options = function () {
  // Defaults build options
  var extraDefaults = {};
  if (this.options.build && !Array.isArray(this.options.build.loaders)) extraDefaults.loaders = defaultsLoaders;
  if (this.options.build && !Array.isArray(this.options.build.postcss)) extraDefaults.postcss = defaultsPostcss;
  this.options.build = _.defaultsDeep(this.options.build, defaults, extraDefaults);
  // Production, create server-renderer
  if (!this.dev) {
    var serverConfig = getWebpackServerConfig.call(this);
    var bundlePath = join(serverConfig.output.path, serverConfig.output.filename);
    if (fs.existsSync(bundlePath)) {
      var bundle = fs.readFileSync(bundlePath, 'utf8');
      createRenderer.call(this, bundle);
    }
  }
};

exports.build = __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.mark(function _callee() {
  return __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.wrap(function _callee$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          // Check if pages dir exists and warn if not
          if (!fs.existsSync(join(this.srcDir, 'pages'))) {
            if (fs.existsSync(join(this.srcDir, '..', 'pages'))) {
              console.error('> No `pages` directory found. Did you mean to run `nuxt` in the parent (`../`) directory?'); // eslint-disable-line no-console
            } else {
              console.error('> Couldn\'t find a `pages` directory. Please create one under the project root'); // eslint-disable-line no-console
            }
            process.exit(1);
          }
          debug('App root: ' + this.srcDir);
          debug('Generating .nuxt/ files...');
          // Create .nuxt/, .nuxt/components and .nuxt/dist folders
          _context.next = 5;
          return remove(r(this.dir, '.nuxt'));

        case 5:
          _context.next = 7;
          return mkdirp(r(this.dir, '.nuxt/components'));

        case 7:
          if (this.dev) {
            _context.next = 10;
            break;
          }

          _context.next = 10;
          return mkdirp(r(this.dir, '.nuxt/dist'));

        case 10:
          _context.next = 12;
          return generateRoutesAndFiles.call(this);

        case 12:
          _context.next = 14;
          return buildFiles.call(this);

        case 14:
          return _context.abrupt('return', this);

        case 15:
        case 'end':
          return _context.stop();
      }
    }
  }, _callee, this);
});

function buildFiles() {
  return __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.wrap(function buildFiles$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          if (!this.dev) {
            _context2.next = 7;
            break;
          }

          debug('Adding webpack middlewares...');
          createWebpackMiddlewares.call(this);
          webpackWatchAndUpdate.call(this);
          watchPages.call(this);
          _context2.next = 10;
          break;

        case 7:
          debug('Building files...');
          _context2.next = 10;
          return [webpackRunClient.call(this), webpackRunServer.call(this)];

        case 10:
        case 'end':
          return _context2.stop();
      }
    }
  }, _marked[0], this);
}

function generateRoutesAndFiles() {
  var _this = this;

  var layouts, layoutsFiles, files, templatesFiles, templateVars, moveTemplates;
  return __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.wrap(function generateRoutesAndFiles$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          debug('Generating routes...');
          // Layouts
          layouts = {};
          _context3.next = 4;
          return glob('layouts/*.vue', { cwd: this.srcDir });

        case 4:
          layoutsFiles = _context3.sent;

          layoutsFiles.forEach(function (file) {
            var name = file.split('/').slice(-1)[0].replace('.vue', '');
            if (name === 'error') return;
            layouts[name] = r(_this.srcDir, file);
          });
          // Generate routes based on files
          _context3.next = 8;
          return glob('pages/**/*.vue', { cwd: this.srcDir });

        case 8:
          files = _context3.sent;

          this.routes = _.uniq(_.map(files, function (file) {
            return file.replace(/^pages/, '').replace(/\.vue$/, '').replace(/\/index/g, '').replace(/_/g, ':').replace('', '/').replace(/\/{2,}/g, '/');
          }));
          // Interpret and move template files to .nuxt/
          debug('Generating files...');
          templatesFiles = ['App.vue', 'client.js', 'index.js', 'router.js', 'server.js', 'utils.js', 'components/nuxt-loading.vue', 'components/nuxt-child.js', 'components/nuxt-link.js', 'components/nuxt.vue'];
          templateVars = {
            uniqBy: _.uniqBy,
            isDev: this.dev,
            router: {
              base: this.options.router.base,
              linkActiveClass: this.options.router.linkActiveClass
            },
            env: this.options.env,
            head: this.options.head,
            store: this.options.store,
            css: this.options.css,
            plugins: this.options.plugins.map(function (p) {
              return r(_this.srcDir, p);
            }),
            appPath: './App.vue',
            layouts: layouts,
            loading: typeof this.options.loading === 'string' ? r(this.srcDir, this.options.loading) : this.options.loading,
            transition: this.options.transition,
            components: {
              Loading: r(__dirname, 'app', 'components', 'nuxt-loading.vue'),
              ErrorPage: r(__dirname, 'app', 'components', 'nuxt-error.vue')
            }
          };
          // Format routes for the lib/app/router.js template

          templateVars.router.routes = createRoutes(files, this.srcDir);
          if (layoutsFiles.indexOf('layouts/error.vue') !== -1) {
            templateVars.components.ErrorPage = r(this.srcDir, 'layouts/error.vue');
          }
          // If no default layout, create its folder and add the default folder

          if (layouts.default) {
            _context3.next = 20;
            break;
          }

          _context3.next = 18;
          return mkdirp(r(this.dir, '.nuxt/layouts'));

        case 18:
          templatesFiles.push('layouts/default.vue');
          layouts.default = r(__dirname, 'app', 'layouts', 'default.vue');

        case 20:
          moveTemplates = templatesFiles.map(function (file) {
            return readFile(r(__dirname, 'app', file), 'utf8').then(function (fileContent) {
              var template = _.template(fileContent);
              var content = template(templateVars);
              return writeFile(r(_this.dir, '.nuxt', file), content, 'utf8');
            });
          });
          _context3.next = 23;
          return moveTemplates;

        case 23:
        case 'end':
          return _context3.stop();
      }
    }
  }, _marked[1], this);
}

function createRoutes(files, srcDir) {
  var routes = [];
  files.forEach(function (file) {
    var keys = file.replace(/^pages/, '').replace(/\.vue$/, '').replace(/\/{2,}/g, '/').split('/').slice(1);
    var route = { name: '', path: '', component: r(srcDir, file), _name: null };
    var parent = routes;
    keys.forEach(function (key, i) {
      route.name = route.name ? route.name + '-' + key.replace('_', '') : key.replace('_', '');
      var child = _.find(parent, { name: route.name });
      if (child) {
        if (!child.children) {
          child.children = [];
        }
        parent = child.children;
        route.path = '';
      } else {
        if (key === 'index' && i + 1 === keys.length) {
          route.path += i > 0 ? '' : '/';
        } else {
          route.path += '/' + key.replace('_', ':');
          if (key.indexOf('_') !== -1) {
            route.path += '?';
          }
        }
      }
    });
    route._name = '_' + hash(route.component);
    // Order Routes path
    parent.push(route);
    parent.sort(function (a, b) {
      var isA = a.path[0] === ':' || a.path[1] === ':' ? 1 : 0;
      var isB = b.path[0] === ':' || b.path[1] === ':' ? 1 : 0;
      return isA - isB === 0 ? a.path.length - b.path.length : isA - isB;
    });
  });
  return cleanChildrenRoutes(routes);
}

function cleanChildrenRoutes(routes) {
  var isChild = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

  var hasIndex = false;
  var parents = [];
  routes.forEach(function (route) {
    route.path = isChild ? route.path.replace('/', '') : route.path;
    if (isChild && /-index$/.test(route.name) || !isChild && route.name === 'index') {
      hasIndex = true;
    }
    route.path = hasIndex ? route.path.replace('?', '') : route.path;
    if (/-index$/.test(route.name)) {
      parents.push(route.name);
    } else {
      if (parents.indexOf(route.name.split('-').slice(0, -1).join('-') + '-index') > -1) {
        route.path = route.path.replace('?', '');
      }
    }
    route.name = route.name.replace(/-index$/, '');
    if (route.children) {
      delete route.name;
      route.children = cleanChildrenRoutes(route.children, true);
    }
  });
  return routes;
}

function getWebpackClientConfig() {
  return clientWebpackConfig.call(this);
}

function getWebpackServerConfig() {
  return serverWebpackConfig.call(this);
}

function createWebpackMiddlewares() {
  var clientConfig = getWebpackClientConfig.call(this);
  // setup on the fly compilation + hot-reload
  clientConfig.entry.app = _.flatten(['webpack-hot-middleware/client?reload=true', clientConfig.entry.app]);
  clientConfig.plugins.push(new webpack.HotModuleReplacementPlugin(), new webpack.NoErrorsPlugin());
  var clientCompiler = webpack(clientConfig);
  // Add the middlewares to the instance context
  this.webpackDevMiddleware = pify(__webpack_require__(42)(clientCompiler, {
    publicPath: clientConfig.output.publicPath,
    stats: {
      colors: true,
      chunks: false
    },
    quiet: false,
    noInfo: true
  }));
  this.webpackHotMiddleware = pify(__webpack_require__(43)(clientCompiler));
}

function webpackWatchAndUpdate() {
  var _this2 = this;

  var MFS = __webpack_require__(39); // <- dependencies of webpack
  var mfs = new MFS();
  var serverConfig = getWebpackServerConfig.call(this);
  var serverCompiler = webpack(serverConfig);
  var outputPath = join(serverConfig.output.path, serverConfig.output.filename);
  serverCompiler.outputFileSystem = mfs;
  this.webpackServerWatcher = serverCompiler.watch({}, function (err, stats) {
    if (err) throw err;
    stats = stats.toJson();
    stats.errors.forEach(function (err) {
      return console.error(err);
    }); // eslint-disable-line no-console
    stats.warnings.forEach(function (err) {
      return console.warn(err);
    }); // eslint-disable-line no-console
    createRenderer.call(_this2, mfs.readFileSync(outputPath, 'utf-8'));
  });
}

function webpackRunClient() {
  var _this3 = this;

  return new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function (resolve, reject) {
    var clientConfig = getWebpackClientConfig.call(_this3);
    var serverCompiler = webpack(clientConfig);
    serverCompiler.run(function (err, stats) {
      if (err) return reject(err);
      console.log('[nuxt:build:client]\n', stats.toString({ chunks: false, colors: true })); // eslint-disable-line no-console
      resolve();
    });
  });
}

function webpackRunServer() {
  var _this4 = this;

  return new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function (resolve, reject) {
    var serverConfig = getWebpackServerConfig.call(_this4);
    var serverCompiler = webpack(serverConfig);
    serverCompiler.run(function (err, stats) {
      if (err) return reject(err);
      console.log('[nuxt:build:server]\n', stats.toString({ chunks: false, colors: true })); // eslint-disable-line no-console
      var bundlePath = join(serverConfig.output.path, serverConfig.output.filename);
      readFile(bundlePath, 'utf8').then(function (bundle) {
        createRenderer.call(_this4, bundle);
        resolve();
      });
    });
  });
}

function createRenderer(bundle) {
  // Create bundle renderer to give a fresh context for every request
  var cacheConfig = false;
  if (this.options.cache) {
    this.options.cache = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_typeof___default()(this.options.cache) !== 'object' ? {} : this.options.cache;
    cacheConfig = __webpack_require__(38)(_.defaults(this.options.cache, {
      max: 1000,
      maxAge: 1000 * 60 * 15
    }));
  }
  this.renderer = createBundleRenderer(bundle, {
    cache: cacheConfig
  });
  this.renderToString = pify(this.renderer.renderToString);
  this.renderToStream = this.renderer.renderToStream;
}

function watchPages() {
  var _this5 = this;

  var patterns = [r(this.srcDir, 'pages'), r(this.srcDir, 'pages/*.vue'), r(this.srcDir, 'pages/**/*.vue'), r(this.srcDir, 'layouts'), r(this.srcDir, 'layouts/*.vue'), r(this.srcDir, 'layouts/**/*.vue')];
  var options = {
    ignoreInitial: true
  };
  /* istanbul ignore next */
  var refreshFiles = _.debounce(function () {
    var d = Date.now();
    co(generateRoutesAndFiles.bind(_this5)).then(function () {
      console.log('Time to gen:' + (Date.now() - d) + 'ms'); // eslint-disable-line no-console
    });
  }, 200);
  this.pagesFilesWatcher = chokidar.watch(patterns, options).on('add', refreshFiles).on('unlink', refreshFiles);
}

/***/ },
/* 19 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__ = __webpack_require__(15);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_typeof__ = __webpack_require__(16);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_typeof___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_typeof__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator__);






var debug = __webpack_require__(9)('nuxt:generate');
var fs = __webpack_require__(6);
var co = __webpack_require__(5);
var pify = __webpack_require__(7);
var pathToRegexp = __webpack_require__(40);
var _ = __webpack_require__(0);

var _require = __webpack_require__(1),
    resolve = _require.resolve,
    join = _require.join,
    dirname = _require.dirname,
    sep = _require.sep;

var _require2 = __webpack_require__(2),
    promisifyRouteParams = _require2.promisifyRouteParams;

var _require3 = __webpack_require__(35),
    minify = _require3.minify;

var copy = pify(fs.copy);
var remove = pify(fs.remove);
var writeFile = pify(fs.writeFile);
var mkdirp = pify(fs.mkdirp);

var defaults = {
  dir: 'dist',
  routeParams: {}
};

module.exports = function () {
  var _this = this;

  var s = Date.now();
  /*
  ** Update loaders config to add router.base path
  */
  // this.options.build.loaders.forEach((config) => {
  //   if (['file', 'url', 'file-loader', 'url-loader'].includes(config.loader)) {
  //     config.query = config.query || {}
  //     config.query.publicPath = urlJoin(this.options.router.base, '/_nuxt/')
  //   }
  // })
  /*
  ** Set variables
  */
  this.options.generate = _.defaultsDeep(this.options.generate, defaults);
  var self = this;
  var srcStaticPath = resolve(this.srcDir, 'static');
  var srcBuiltPath = resolve(this.dir, '.nuxt', 'dist');
  var distPath = resolve(this.dir, this.options.generate.dir);
  var distNuxtPath = resolve(distPath, '_nuxt');
  return co(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function _callee() {
    return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return self.build();

          case 2:
            _context.prev = 2;
            _context.next = 5;
            return remove(distPath);

          case 5:
            debug('Destination folder cleaned');
            _context.next = 10;
            break;

          case 8:
            _context.prev = 8;
            _context.t0 = _context['catch'](2);

          case 10:
            if (!fs.existsSync(srcStaticPath)) {
              _context.next = 13;
              break;
            }

            _context.next = 13;
            return copy(srcStaticPath, distPath);

          case 13:
            _context.next = 15;
            return copy(srcBuiltPath, distNuxtPath);

          case 15:
            debug('Static & build files copied');

          case 16:
          case 'end':
            return _context.stop();
        }
      }
    }, _callee, this, [[2, 8]]);
  })).then(function () {
    // Resolve config.generate.routesParams promises before generating the routes
    return resolveRouteParams(_this.options.generate.routeParams);
  }).then(function () {
    /*
    ** Generate html files from routes
    */
    var routes = [];
    _this.routes.forEach(function (route) {
      if (route.indexOf(':') !== -1 || route.indexOf('*') !== -1) {
        var _ret = function () {
          var routeParams = _this.options.generate.routeParams[route];
          if (!routeParams) {
            console.error('Could not generate the dynamic route ' + route + ', please add the mapping params in nuxt.config.js (generate.routeParams).'); // eslint-disable-line no-console
            return {
              v: process.exit(1)
            };
          }
          var toPath = pathToRegexp.compile(route);
          routes = routes.concat(routeParams.map(function (params) {
            return toPath(params);
          }));
        }();

        if ((typeof _ret === 'undefined' ? 'undefined' : __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_typeof___default()(_ret)) === "object") return _ret.v;
      } else {
        routes.push(route);
      }
    });
    return co(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function _callee3() {
      return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              if (!routes.length) {
                _context3.next = 5;
                break;
              }

              _context3.next = 3;
              return routes.splice(0, 500).map(function (route) {
                return co(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.mark(function _callee2() {
                  var _ref, html, path;

                  return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_regenerator___default.a.wrap(function _callee2$(_context2) {
                    while (1) {
                      switch (_context2.prev = _context2.next) {
                        case 0:
                          _context2.next = 2;
                          return self.renderRoute(route, { _generate: true });

                        case 2:
                          _ref = _context2.sent;
                          html = _ref.html;

                          html = minify(html, {
                            collapseBooleanAttributes: true,
                            collapseWhitespace: true,
                            decodeEntities: true,
                            minifyCSS: true,
                            minifyJS: true,
                            processConditionalComments: true,
                            removeAttributeQuotes: false,
                            removeComments: false,
                            removeEmptyAttributes: true,
                            removeOptionalTags: true,
                            removeRedundantAttributes: true,
                            removeScriptTypeAttributes: true,
                            removeStyleLinkTypeAttributes: true,
                            removeTagWhitespace: true,
                            sortAttributes: true,
                            sortClassName: true,
                            trimCustomFragments: true,
                            useShortDoctype: true
                          });
                          path = join(route, sep, 'index.html'); // /about -> /about/index.html

                          debug('Generate file: ' + path);
                          path = join(distPath, path);
                          // Make sure the sub folders are created
                          _context2.next = 10;
                          return mkdirp(dirname(path));

                        case 10:
                          _context2.next = 12;
                          return writeFile(path, html, 'utf8');

                        case 12:
                        case 'end':
                          return _context2.stop();
                      }
                    }
                  }, _callee2, this);
                }));
              });

            case 3:
              _context3.next = 0;
              break;

            case 5:
            case 'end':
              return _context3.stop();
          }
        }
      }, _callee3, this);
    }));
  }).then(function (pages) {
    // Add .nojekyll file to let Github Pages add the _nuxt/ folder
    // https://help.github.com/articles/files-that-start-with-an-underscore-are-missing/
    var nojekyllPath = resolve(distPath, '.nojekyll');
    return writeFile(nojekyllPath, '');
  }).then(function () {
    var duration = Math.round((Date.now() - s) / 100) / 10;
    debug('HTML Files generated in ' + duration + 's');
    return _this;
  });
};

function resolveRouteParams(routeParams) {
  var promises = [];
  __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(routeParams).forEach(function (routePath) {
    var promise = promisifyRouteParams(routeParams[routePath]);
    promise.then(function (routeParamsData) {
      routeParams[routePath] = routeParamsData;
    }).catch(function (e) {
      console.error('Could not resolve routeParams[' + routePath + ']'); // eslint-disable-line no-console
      console.error(e); // eslint-disable-line no-console
      process.exit(1);
    });
    promises.push(promise);
  });
  return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a.all(promises);
}

/***/ },
/* 20 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator__);


var debug = __webpack_require__(9)('nuxt:render');
debug.color = 4; // force blue color
var co = __webpack_require__(5);

var _require = __webpack_require__(2),
    urlJoin = _require.urlJoin;

var _require2 = __webpack_require__(2),
    getContext = _require2.getContext;

exports.render = function (req, res) {
  var _this = this;

  if (!this.renderer && !this.dev) {
    console.error('> No build files found, please run `nuxt build` before launching `nuxt start`'); // eslint-disable-line no-console
    process.exit(1);
  }
  /* istanbul ignore if */
  if (!this.renderer) {
    setTimeout(function () {
      _this.render(req, res);
    }, 1000);
    return;
  }
  var self = this;
  var context = getContext(req, res);
  co(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator___default.a.mark(function _callee() {
    var url;
    return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator___default.a.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            if (!self.dev) {
              _context.next = 5;
              break;
            }

            _context.next = 3;
            return self.webpackDevMiddleware(req, res);

          case 3:
            _context.next = 5;
            return self.webpackHotMiddleware(req, res);

          case 5:
            // If base in req.url, remove it for the middlewares and vue-router
            if (self.options.router.base !== '/' && req.url.indexOf(self.options.router.base) === 0) {
              // Compatibility with base url for dev server
              req.url = req.url.replace(self.options.router.base, '/');
            }
            // Serve static/ files
            _context.next = 8;
            return self.serveStatic(req, res);

          case 8:
            if (!(!self.dev && self._nuxtRegexp.test(req.url))) {
              _context.next = 14;
              break;
            }

            url = req.url;

            req.url = req.url.replace(self._nuxtRegexp, '/');
            _context.next = 13;
            return self.serveStaticNuxt(req, res);

          case 13:
            /* istanbul ignore next */
            req.url = url;

          case 14:
          case 'end':
            return _context.stop();
        }
      }
    }, _callee, this);
  })).then(function () {
    /* istanbul ignore if */
    if (_this.dev && _this._nuxtRegexp.test(req.url) && req.url.indexOf('.hot-update.json') !== -1) {
      res.statusCode = 404;
      return res.end();
    }
    return _this.renderRoute(req.url, context);
  }).then(function (_ref) {
    var html = _ref.html,
        error = _ref.error;

    if (error) {
      res.statusCode = context.nuxt.error.statusCode || 500;
    }
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    res.setHeader('Content-Length', Buffer.byteLength(html));
    res.end(html, 'utf8');
  }).catch(function (err) {
    res.statusCode = 500;
    res.end(_this.errorTemplate({ err: err }), 'utf8');
  });
};

exports.renderRoute = function (url) {
  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  debug('Rendering url ' + url);
  // Add url and isSever to the context
  context.url = url;
  context.isServer = true;
  // Call rendertoSting from the bundleRenderer and generate the HTML (will update the context as well)
  var self = this;
  return co(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator___default.a.mark(function _callee2() {
    var app, html;
    return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_regenerator___default.a.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return self.renderToString(context);

          case 2:
            app = _context2.sent;

            if (!context.nuxt.serverRendered) {
              app = '<div id="__nuxt"></div>';
            }
            html = self.appTemplate({
              dev: self.dev, // Use to add the extracted CSS <link> in production
              baseUrl: self.options.router.base,
              APP: app,
              context: context,
              files: {
                css: urlJoin(self.options.router.base, '/_nuxt/', self.options.build.filenames.css),
                vendor: urlJoin(self.options.router.base, '/_nuxt/', self.options.build.filenames.vendor),
                app: urlJoin(self.options.router.base, '/_nuxt/', self.options.build.filenames.app)
              }
            });
            return _context2.abrupt('return', {
              html: html,
              error: context.nuxt.error,
              redirected: context.redirected
            });

          case 6:
          case 'end':
            return _context2.stop();
        }
      }
    }, _callee2, this);
  }));
};

// Function used to do dom checking via jsdom
var jsdom = null;
exports.renderAndGetWindow = function renderAndGetWindow(url) {
  /* istanbul ignore if */
  if (!jsdom) {
    try {
      jsdom = __webpack_require__(37);
    } catch (e) {
      console.error('Fail when calling nuxt.renderAndGetWindow(url)'); // eslint-disable-line no-console
      console.error('jsdom module is not installed'); // eslint-disable-line no-console
      console.error('Please install jsdom with: npm install --save-dev jsdom'); // eslint-disable-line no-console
      process.exit(1);
    }
  }
  var virtualConsole = jsdom.createVirtualConsole().sendTo(console);
  url = url || 'http://localhost:3000';
  return new __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a(function (resolve, reject) {
    jsdom.env({
      url: url,
      features: {
        FetchExternalResources: ['script', 'link'],
        ProcessExternalResources: ['script']
      },
      virtualConsole: virtualConsole,
      done: function done(err, window) {
        if (err) return reject(err);
        // Mock window.scrollTo
        window.scrollTo = function () {};
        // If Nuxt could not be loaded (error from the server-side)
        if (!window.__NUXT__) {
          return reject({
            message: 'Could not load the nuxt app',
            body: window.document.getElementsByTagName('body')[0].innerHTML
          });
        }
        // Used by nuxt.js to say when the components are loaded and the app ready
        window.onNuxtReady(function () {
          resolve(window);
        });
      }
    });
  });
};

/***/ },
/* 21 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__ = __webpack_require__(11);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__);




var http = __webpack_require__(36);

var Server = function () {
  function Server(nuxt) {
    __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default()(this, Server);

    this.nuxt = nuxt;
    this.server = http.createServer(this.render.bind(this));
    return this;
  }

  __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default()(Server, [{
    key: 'render',
    value: function render(req, res) {
      this.nuxt.render(req, res);
      return this;
    }
  }, {
    key: 'listen',
    value: function listen(port, host) {
      host = host || 'localhost';
      port = port || 3000;
      this.server.listen(port, host, function () {
        console.log('Ready on http://%s:%s', host, port); // eslint-disable-line no-console
      });
      return this;
    }
  }, {
    key: 'close',
    value: function close(cb) {
      return this.server.close(cb);
    }
  }]);

  return Server;
}();

module.exports = Server;

/***/ },
/* 22 */
/***/ function(module, exports) {

module.exports = require("ansi-html");

/***/ },
/* 23 */
/***/ function(module, exports) {

module.exports = require("serialize-javascript");

/***/ },
/* 24 */
/***/ function(module, exports) {

module.exports = require("serve-static");

/***/ },
/* 25 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign__ = __webpack_require__(14);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign__);
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__ = __webpack_require__(8);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__);




var _ = __webpack_require__(0);
var webpack = __webpack_require__(10);
var ExtractTextPlugin = __webpack_require__(17);
var base = __webpack_require__(13);

var _require = __webpack_require__(1),
    resolve = _require.resolve;

/*
|--------------------------------------------------------------------------
| Webpack Client Config
|
| Generate public/dist/client-vendor-bundle.js
| Generate public/dist/client-bundle.js
|
| In production, will generate public/dist/style.css
|--------------------------------------------------------------------------
*/


module.exports = function () {
  var config = base.call(this);

  // Entry
  config.entry.app = resolve(this.dir, '.nuxt', 'client.js');

  // Add vendors
  if (this.options.store) {
    config.entry.vendor.push('vuex');
  }
  config.entry.vendor = config.entry.vendor.concat(this.options.build.vendor);

  // Output
  config.output.path = resolve(this.dir, '.nuxt', 'dist');
  config.output.filename = this.options.build.filenames.app;

  // env object defined in nuxt.config.js
  var env = {};
  _.each(this.options.env, function (value, key) {
    env['process.env.' + key] = typeof value === 'string' ? __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(value) : value;
  });
  // Webpack plugins
  config.plugins = (config.plugins || []).concat([
  // strip comments in Vue code
  new webpack.DefinePlugin(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_assign___default()(env, {
    'process.env.NODE_ENV': __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(this.dev ? 'development' : 'production'),
    'process.BROWSER_BUILD': true,
    'process.SERVER_BUILD': false
  })),
  // Extract vendor chunks for better caching
  new webpack.optimize.CommonsChunkPlugin({
    name: 'vendor',
    filename: this.options.build.filenames.vendor
  })]);

  // Production client build
  if (!this.dev) {
    config.plugins.push(
    // Use ExtractTextPlugin to extract CSS into a single file
    new ExtractTextPlugin({
      filename: this.options.build.filenames.css,
      allChunks: true
    }),
    // This is needed in webpack 2 for minifying CSS
    new webpack.LoaderOptionsPlugin({
      minimize: true
    }),
    // Minify JS
    new webpack.optimize.UglifyJsPlugin({
      compress: {
        warnings: false
      }
    }));
  }
  // Extend config
  if (typeof this.options.build.extend === 'function') {
    this.options.build.extend(config, {
      dev: this.dev,
      isClient: true
    });
  }
  return config;
};

/***/ },
/* 26 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__ = __webpack_require__(15);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_assign__ = __webpack_require__(14);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_assign___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_assign__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify__ = __webpack_require__(8);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify__);





var _ = __webpack_require__(0);
var webpack = __webpack_require__(10);
var base = __webpack_require__(13);

var _require = __webpack_require__(0),
    uniq = _require.uniq;

var _require2 = __webpack_require__(32),
    existsSync = _require2.existsSync,
    readFileSync = _require2.readFileSync;

var _require3 = __webpack_require__(1),
    resolve = _require3.resolve;

/*
|--------------------------------------------------------------------------
| Webpack Server Config
|--------------------------------------------------------------------------
*/


module.exports = function () {
  var config = base.call(this);

  // env object defined in nuxt.config.js
  var env = {};
  _.each(this.options.env, function (value, key) {
    env['process.env.' + key] = typeof value === 'string' ? __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify___default()(value) : value;
  });

  config = __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_assign___default()(config, {
    target: 'node',
    devtool: false,
    entry: resolve(this.dir, '.nuxt', 'server.js'),
    output: __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_assign___default()({}, config.output, {
      path: resolve(this.dir, '.nuxt', 'dist'),
      filename: 'server-bundle.js',
      libraryTarget: 'commonjs2'
    }),
    plugins: (config.plugins || []).concat([new webpack.DefinePlugin(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_assign___default()(env, {
      'process.env.NODE_ENV': __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_json_stringify___default()(this.dev ? 'development' : 'production'),
      'process.BROWSER_BUILD': false,
      'process.SERVER_BUILD': true
    }))])
  });

  // Externals
  var nuxtPackageJson = __webpack_require__(28);
  var projectPackageJsonPath = resolve(this.dir, 'package.json');
  config.externals = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(nuxtPackageJson.dependencies || {});
  if (existsSync(projectPackageJsonPath)) {
    try {
      var projectPackageJson = JSON.parse(readFileSync(projectPackageJsonPath));
      config.externals = config.externals.concat(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(projectPackageJson.dependencies || {}));
    } catch (e) {}
  }
  config.externals = uniq(config.externals);

  // Extend config
  if (typeof this.options.build.extend === 'function') {
    this.options.build.extend(config, {
      dev: this.dev,
      isServer: true
    });
  }
  return config;
};

/***/ },
/* 27 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__ = __webpack_require__(8);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__);




var _require = __webpack_require__(0),
    defaults = _require.defaults;

module.exports = function () {
  var babelOptions = __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(defaults(this.options.build.babel, {
    plugins: ['transform-async-to-generator', 'transform-runtime'],
    presets: [['es2015', { modules: false }], 'stage-2']
  }));
  var config = {
    postcss: this.options.build.postcss,
    loaders: {
      'js': 'babel-loader?' + babelOptions,
      'less': 'vue-style-loader!css-loader!less-loader',
      'sass': 'vue-style-loader!css-loader!sass-loader?indentedSyntax',
      'scss': 'vue-style-loader!css-loader!sass-loader',
      'stylus': 'vue-style-loader!css-loader!stylus-loader',
      'styl': 'vue-style-loader!css-loader!stylus-loader'
    },
    preserveWhitespace: false
  };

  if (!this.dev) {
    // Use ExtractTextPlugin to extract CSS into a single file
    var ExtractTextPlugin = __webpack_require__(17);
    config.loaders.css = ExtractTextPlugin.extract({ loader: 'css-loader' });
    config.loaders.scss = ExtractTextPlugin.extract({ loader: 'css-loader!sass-loader', fallbackLoader: 'vue-style-loader' });
    config.loaders.sass = ExtractTextPlugin.extract({ loader: 'css-loader!sass-loader?indentedSyntax', fallbackLoader: 'vue-style-loader' });
    config.loaders.stylus = ExtractTextPlugin.extract({ loader: 'css-loader!stylus-loader', fallbackLoader: 'vue-style-loader' });
    config.loaders.less = ExtractTextPlugin.extract({ loader: 'css-loader!less-loader', fallbackLoader: 'vue-style-loader' });
  }

  // Return the config
  return config;
};

/***/ },
/* 28 */
/***/ function(module, exports) {

module.exports = {
	"name": "nuxt",
	"version": "0.9.5",
	"description": "A minimalistic framework for server-rendered Vue.js applications (inspired by Next.js)",
	"contributors": [
		{
			"name": "Sebastien Chopin"
		},
		{
			"name": "Alexandre Chopin"
		}
	],
	"main": "./dist/nuxt.js",
	"license": "MIT",
	"repository": {
		"type": "git",
		"url": "git+https://github.com/nuxt/nuxt.js"
	},
	"files": [
		"bin",
		"dist"
	],
	"keywords": [
		"nuxt",
		"nuxt.js",
		"nuxtjs",
		"vue",
		"vue.js",
		"vuejs",
		"next.js",
		"vue ssr"
	],
	"homepage": "https://github.com/nuxt/nuxt.js#readme",
	"bin": {
		"nuxt": "./bin/nuxt"
	},
	"scripts": {
		"test": "nyc ava --serial test/",
		"coverage": "nyc report --reporter=text-lcov > coverage.lcov && codecov",
		"lint": "eslint --ext .js,.vue bin lib pages test/*.js --ignore-pattern lib/app",
		"build": "webpack",
		"watch": "webpack --watch",
		"precommit": "npm run lint",
		"prepublish": "npm run build"
	},
	"dependencies": {
		"ansi-html": "^0.0.6",
		"autoprefixer": "^6.6.0",
		"babel-core": "^6.21.0",
		"babel-loader": "^6.2.10",
		"babel-plugin-array-includes": "^2.0.3",
		"babel-plugin-transform-async-to-generator": "^6.16.0",
		"babel-plugin-transform-runtime": "^6.15.0",
		"babel-preset-es2015": "^6.18.0",
		"babel-preset-stage-2": "^6.18.0",
		"chokidar": "^1.6.1",
		"co": "^4.6.0",
		"cross-spawn": "^5.0.1",
		"css-loader": "^0.26.1",
		"debug": "^2.5.2",
		"es6-object-assign": "^1.0.3",
		"es6-promise": "^4.0.5",
		"extract-text-webpack-plugin": "2.0.0-beta.4",
		"file-loader": "^0.9.0",
		"fs-extra": "^1.0.0",
		"glob": "^7.1.1",
		"hash-sum": "^1.0.2",
		"html-minifier": "^3.2.3",
		"lodash": "^4.17.3",
		"lru-cache": "^4.0.2",
		"memory-fs": "^0.4.1",
		"path-to-regexp": "^1.7.0",
		"pify": "^2.3.0",
		"serialize-javascript": "^1.3.0",
		"serve-static": "^1.11.1",
		"url-loader": "^0.5.7",
		"vue": "^2.1.7",
		"vue-loader": "^10.0.2",
		"vue-meta": "^0.5.3",
		"vue-router": "^2.1.1",
		"vue-server-renderer": "^2.1.7",
		"vue-template-compiler": "^2.1.7",
		"vuex": "^2.1.1",
		"webpack": "2.2.0-rc.2",
		"webpack-dev-middleware": "^1.9.0",
		"webpack-hot-middleware": "^2.14.0"
	},
	"devDependencies": {
		"ava": "^0.17.0",
		"babel-eslint": "^7.1.1",
		"codecov": "^1.0.1",
		"copy-webpack-plugin": "^4.0.1",
		"eslint": "^3.10.2",
		"eslint-config-standard": "^6.2.1",
		"eslint-plugin-html": "^1.7.0",
		"eslint-plugin-promise": "^3.4.0",
		"eslint-plugin-standard": "^2.0.1",
		"finalhandler": "^0.5.1",
		"jsdom": "^9.8.3",
		"json-loader": "^0.5.4",
		"nyc": "^10.0.0",
		"request": "^2.79.0",
		"request-promise-native": "^1.0.3",
		"webpack-node-externals": "^1.5.4"
	}
};

/***/ },
/* 29 */
/***/ function(module, exports) {

module.exports = require("autoprefixer");

/***/ },
/* 30 */
/***/ function(module, exports) {

module.exports = require("babel-runtime/core-js/array/from");

/***/ },
/* 31 */
/***/ function(module, exports) {

module.exports = require("chokidar");

/***/ },
/* 32 */
/***/ function(module, exports) {

module.exports = require("fs");

/***/ },
/* 33 */
/***/ function(module, exports) {

module.exports = require("glob");

/***/ },
/* 34 */
/***/ function(module, exports) {

module.exports = require("hash-sum");

/***/ },
/* 35 */
/***/ function(module, exports) {

module.exports = require("html-minifier");

/***/ },
/* 36 */
/***/ function(module, exports) {

module.exports = require("http");

/***/ },
/* 37 */
/***/ function(module, exports) {

module.exports = require("jsdom");

/***/ },
/* 38 */
/***/ function(module, exports) {

module.exports = require("lru-cache");

/***/ },
/* 39 */
/***/ function(module, exports) {

module.exports = require("memory-fs");

/***/ },
/* 40 */
/***/ function(module, exports) {

module.exports = require("path-to-regexp");

/***/ },
/* 41 */
/***/ function(module, exports) {

module.exports = require("vue-server-renderer");

/***/ },
/* 42 */
/***/ function(module, exports) {

module.exports = require("webpack-dev-middleware");

/***/ },
/* 43 */
/***/ function(module, exports) {

module.exports = require("webpack-hot-middleware");

/***/ },
/* 44 */
/***/ function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_classCallCheck__ = __webpack_require__(11);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_classCallCheck__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_createClass__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_createClass__);




var _ = __webpack_require__(0);
var co = __webpack_require__(5);
var fs = __webpack_require__(6);
var pify = __webpack_require__(7);
var ansiHTML = __webpack_require__(22);
var serialize = __webpack_require__(23);
var Server = __webpack_require__(21);
var build = __webpack_require__(18);
var render = __webpack_require__(20);
var generate = __webpack_require__(19);
var serveStatic = __webpack_require__(24);

var _require = __webpack_require__(1),
    resolve = _require.resolve,
    join = _require.join;

var _require2 = __webpack_require__(2),
    encodeHtml = _require2.encodeHtml,
    setAnsiColors = _require2.setAnsiColors;

setAnsiColors(ansiHTML);

var Nuxt = function () {
  function Nuxt() {
    var _this = this;

    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_classCallCheck___default()(this, Nuxt);

    var defaults = {
      // special options
      _renderer: true,
      _build: true,
      // general options
      dev: true,
      env: {},
      head: {},
      plugins: [],
      css: [],
      cache: false,
      loading: {
        color: 'black',
        failedColor: 'red',
        height: '2px',
        duration: 5000
      },
      transition: {
        name: 'page',
        mode: 'out-in'
      },
      router: {
        base: '/',
        linkActiveClass: 'nuxt-link-active'
      },
      build: {}
    };
    if (options.loading === true) delete options.loading;
    if (typeof options.transition === 'string') options.transition = { name: options.transition };
    this.options = _.defaultsDeep(options, defaults);
    // Env variables
    this.dev = this.options.dev;
    this.dir = typeof options.rootDir === 'string' && options.rootDir ? options.rootDir : process.cwd();
    this.srcDir = typeof options.srcDir === 'string' && options.srcDir ? resolve(this.dir, options.srcDir) : this.dir;
    // If store defined, update store options to true
    if (fs.existsSync(join(this.srcDir, 'store', 'index.js'))) {
      this.options.store = true;
    }
    // Template
    this.appTemplate = _.template(fs.readFileSync(resolve(__dirname, 'views', 'app.html'), 'utf8'), {
      imports: { serialize: serialize }
    });
    this.errorTemplate = _.template(fs.readFileSync(resolve(__dirname, 'views', 'error.html'), 'utf8'), {
      imports: { ansiHTML: ansiHTML, encodeHtml: encodeHtml }
    });
    // renderer used by Vue.js (via createBundleRenderer)
    this.renderer = null;
    // For serving static/ files to /
    this.serveStatic = pify(serveStatic(resolve(this.srcDir, 'static')));
    // For serving .nuxt/dist/ files
    this._nuxtRegexp = /^\/_nuxt\//;
    this.serveStaticNuxt = pify(serveStatic(resolve(this.dir, '.nuxt', 'dist')));
    // Add this.Server Class
    this.Server = Server;
    // Add this.build
    build.options.call(this); // Add build options
    this.build = function () {
      return co(build.build.bind(_this));
    };
    // Add this.render and this.renderRoute
    this.render = render.render.bind(this);
    this.renderRoute = render.renderRoute.bind(this);
    this.renderAndGetWindow = render.renderAndGetWindow.bind(this);
    // Add this.generate
    this.generate = generate.bind(this);
    return this;
  }

  __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_createClass___default()(Nuxt, [{
    key: 'close',
    value: function close(callback) {
      var _this2 = this;

      var promises = [];
      /* istanbul ignore if */
      if (this.webpackDevMiddleware) {
        var p = new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function (resolve, reject) {
          _this2.webpackDevMiddleware.close(function () {
            return resolve();
          });
        });
        promises.push(p);
      }
      /* istanbul ignore if */
      if (this.webpackServerWatcher) {
        var _p = new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function (resolve, reject) {
          _this2.webpackServerWatcher.close(function () {
            return resolve();
          });
        });
        promises.push(_p);
      }
      /* istanbul ignore if */
      if (this.pagesFilesWatcher) {
        this.pagesFilesWatcher.close();
      }
      return co(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.mark(function _callee() {
        return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _context.next = 2;
                return promises;

              case 2:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this);
      })).then(function () {
        if (typeof callback === 'function') callback();
      });
    }
  }]);

  return Nuxt;
}();

module.exports = Nuxt;

/***/ }
/******/ ]);
//# sourceMappingURL=nuxt.js.map